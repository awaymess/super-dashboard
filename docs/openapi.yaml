openapi: 3.0.3
info:
  title: Super Dashboard API
  description: |
    Integrated Sports Betting Analytics & Stock Monitoring Platform API.
    
    ## Authentication
    Most endpoints require authentication via JWT Bearer token.
    Use `/api/v1/auth/login` to obtain tokens.
    
    ## Rate Limiting
    - Auth endpoints: 5 requests/minute
    - API endpoints: 100 requests/minute
  version: 1.0.0
  contact:
    name: Super Dashboard Team
  license:
    name: MIT

servers:
  - url: http://localhost:8080
    description: Development server
  - url: https://api.superdashboard.io
    description: Production server

tags:
  - name: health
    description: Health check endpoints
  - name: auth
    description: Authentication endpoints
  - name: betting
    description: Sports betting endpoints
  - name: stocks
    description: Stock monitoring endpoints
  - name: paper-trading
    description: Paper trading endpoints
  - name: nlp
    description: NLP and semantic search endpoints

paths:
  /health:
    get:
      tags: [health]
      summary: Basic health check
      operationId: getHealth
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /health/ready:
    get:
      tags: [health]
      summary: Readiness check
      operationId: getHealthReady
      responses:
        '200':
          description: Service is ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '503':
          description: Service not ready

  /health/live:
    get:
      tags: [health]
      summary: Liveness check
      operationId: getHealthLive
      responses:
        '200':
          description: Service is alive
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /metrics:
    get:
      tags: [health]
      summary: Application metrics
      operationId: getMetrics
      responses:
        '200':
          description: Metrics data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetricsResponse'

  /api/v1/auth/register:
    post:
      tags: [auth]
      summary: Register new user
      operationId: registerUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: User already exists

  /api/v1/auth/login:
    post:
      tags: [auth]
      summary: User login
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/auth/refresh:
    post:
      tags: [auth]
      summary: Refresh access token
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/betting/matches:
    get:
      tags: [betting]
      summary: List all matches
      operationId: listMatches
      parameters:
        - name: league
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
            enum: [scheduled, live, finished]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: List of matches
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Match'

  /api/v1/betting/matches/{id}:
    get:
      tags: [betting]
      summary: Get match by ID
      operationId: getMatch
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Match details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Match'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/betting/matches/{id}/odds:
    get:
      tags: [betting]
      summary: Get match odds
      operationId: getMatchOdds
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Match odds
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Odds'

  /api/v1/betting/value-bets:
    get:
      tags: [betting]
      summary: Get value bets
      operationId: getValueBets
      responses:
        '200':
          description: List of value bets
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ValueBet'

  /api/v1/stocks:
    get:
      tags: [stocks]
      summary: List all stocks
      operationId: listStocks
      responses:
        '200':
          description: List of stocks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Stock'

  /api/v1/stocks/quotes/{symbol}:
    get:
      tags: [stocks]
      summary: Get stock quote
      operationId: getStockQuote
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Stock quote
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StockQuote'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/paper-trading/portfolio:
    get:
      tags: [paper-trading]
      summary: Get portfolio
      operationId: getPortfolio
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Portfolio details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Portfolio'

  /api/v1/paper-trading/trade:
    post:
      tags: [paper-trading]
      summary: Execute trade
      operationId: executeTrade
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TradeRequest'
      responses:
        '201':
          description: Trade executed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '400':
          $ref: '#/components/responses/BadRequest'

  /api/v1/nlp/ingest:
    post:
      tags: [nlp]
      summary: Ingest news article
      description: Ingest a news article for NLP processing (sentiment analysis, embedding generation)
      operationId: ingestNews
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewsIngestRequest'
      responses:
        '201':
          description: News article ingested successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsIngestResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/nlp/search:
    get:
      tags: [nlp]
      summary: Semantic search
      description: Search news articles using semantic similarity
      operationId: semanticSearch
      parameters:
        - name: q
          in: query
          required: true
          description: Search query text
          schema:
            type: string
        - name: limit
          in: query
          description: Maximum number of results
          schema:
            type: integer
            default: 10
            maximum: 100
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /api/v1/nlp/sentiment/{symbol}:
    get:
      tags: [nlp]
      summary: Get sentiment for symbol
      description: Get aggregated sentiment analysis for a stock symbol
      operationId: getSymbolSentiment
      parameters:
        - name: symbol
          in: path
          required: true
          description: Stock symbol (e.g., AAPL)
          schema:
            type: string
        - name: days
          in: query
          description: Number of days to analyze
          schema:
            type: integer
            default: 7
            maximum: 90
      responses:
        '200':
          description: Sentiment analysis for symbol
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SymbolSentimentResponse'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  responses:
    BadRequest:
      description: Invalid request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  schemas:
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: ok
        details:
          type: object

    MetricsResponse:
      type: object
      properties:
        uptime:
          type: string
        uptime_seconds:
          type: number
        requests_total:
          type: integer
        errors_total:
          type: integer
        memory:
          type: object
          properties:
            alloc_bytes:
              type: integer
            sys_bytes:
              type: integer
        goroutines:
          type: integer

    Error:
      type: object
      properties:
        error:
          type: string

    RegisterRequest:
      type: object
      required: [email, password, name]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 6
        name:
          type: string

    RegisterResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
        name:
          type: string

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    LoginResponse:
      type: object
      properties:
        access_token:
          type: string
        refresh_token:
          type: string

    RefreshRequest:
      type: object
      required: [refresh_token]
      properties:
        refresh_token:
          type: string

    RefreshResponse:
      type: object
      properties:
        access_token:
          type: string

    Team:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        country:
          type: string
        elo:
          type: number

    Match:
      type: object
      properties:
        id:
          type: string
          format: uuid
        league:
          type: string
        home_team:
          $ref: '#/components/schemas/Team'
        away_team:
          $ref: '#/components/schemas/Team'
        start_time:
          type: string
          format: date-time
        status:
          type: string
          enum: [scheduled, live, finished]
        venue:
          type: string

    Odds:
      type: object
      properties:
        id:
          type: string
          format: uuid
        match_id:
          type: string
          format: uuid
        bookmaker:
          type: string
        market:
          type: string
        outcome:
          type: string
        price:
          type: number

    ValueBet:
      type: object
      properties:
        match_id:
          type: string
        bet_type:
          type: string
        bookmaker_odds:
          type: number
        fair_odds:
          type: number
        value:
          type: number
        confidence:
          type: integer
        kelly_stake:
          type: number
        expected_value:
          type: number
        recommendation:
          type: string
          enum: [skip, bet, strong_bet]

    Stock:
      type: object
      properties:
        id:
          type: string
          format: uuid
        symbol:
          type: string
        name:
          type: string
        market_cap:
          type: number
        sector:
          type: string

    StockQuote:
      type: object
      properties:
        symbol:
          type: string
        name:
          type: string
        price:
          type: number
        open:
          type: number
        high:
          type: number
        low:
          type: number
        volume:
          type: integer
        market_cap:
          type: number
        sector:
          type: string

    Portfolio:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        initial_balance:
          type: number
        current_balance:
          type: number
        total_value:
          type: number
        cash_balance:
          type: number
        positions:
          type: array
          items:
            $ref: '#/components/schemas/Position'
        performance:
          $ref: '#/components/schemas/PerformanceMetrics'

    Position:
      type: object
      properties:
        id:
          type: string
          format: uuid
        symbol:
          type: string
        name:
          type: string
        quantity:
          type: integer
        avg_cost:
          type: number
        current_price:
          type: number
        market_value:
          type: number
        unrealized_pl:
          type: number
        unrealized_pl_percent:
          type: number

    PerformanceMetrics:
      type: object
      properties:
        total_return:
          type: number
        total_return_percent:
          type: number
        sharpe_ratio:
          type: number
        max_drawdown:
          type: number
        win_rate:
          type: number

    TradeRequest:
      type: object
      required: [symbol, type, order_type, quantity]
      properties:
        symbol:
          type: string
        type:
          type: string
          enum: [buy, sell]
        order_type:
          type: string
          enum: [market, limit, stop, stop_limit]
        quantity:
          type: integer
          minimum: 1
        limit_price:
          type: number
        stop_price:
          type: number

    Transaction:
      type: object
      properties:
        id:
          type: string
          format: uuid
        symbol:
          type: string
        type:
          type: string
        quantity:
          type: integer
        price:
          type: number
        total:
          type: number
        fees:
          type: number
        executed_at:
          type: string
          format: date-time

    NewsIngestRequest:
      type: object
      required: [title, content]
      properties:
        title:
          type: string
          description: News article title
        content:
          type: string
          description: News article content
        source:
          type: string
          description: News source (e.g., Reuters, Bloomberg)
        url:
          type: string
          format: uri
          description: Original article URL
        symbols:
          type: array
          items:
            type: string
          description: Related stock symbols

    NewsIngestResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        sentiment:
          type: object
          properties:
            score:
              type: number
              description: Sentiment score from -1 (negative) to 1 (positive)
            label:
              type: string
              enum: [positive, neutral, negative]
        event_type:
          type: string
          enum: [product_launch, earnings, merger_acquisition, lawsuit, executive_change, dividend, stock_split, bankruptcy, regulation, partnership, layoff, expansion, other]
        embedding_created:
          type: boolean

    SearchResult:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        snippet:
          type: string
        similarity:
          type: number
          description: Cosine similarity score (0-1)
        sentiment:
          type: string
          enum: [positive, neutral, negative]
        published_at:
          type: string
          format: date-time

    SearchResponse:
      type: object
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/SearchResult'
        query_embedding_time_ms:
          type: integer
          description: Time taken to generate query embedding
        search_time_ms:
          type: integer
          description: Time taken to perform similarity search

    SentimentDistribution:
      type: object
      properties:
        positive:
          type: integer
        neutral:
          type: integer
        negative:
          type: integer

    SymbolSentimentResponse:
      type: object
      properties:
        symbol:
          type: string
        period_days:
          type: integer
        article_count:
          type: integer
        average_sentiment:
          type: number
          description: Average sentiment score from -1 to 1
        sentiment_distribution:
          $ref: '#/components/schemas/SentimentDistribution'
        trending_topics:
          type: array
          items:
            type: string
